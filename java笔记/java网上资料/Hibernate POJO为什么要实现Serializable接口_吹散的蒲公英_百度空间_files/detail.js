qing.registNS("qdetail");qdetail.ListenerMgr=(function(){var n=function(u){if(qVisitorInfo.loginStatus=="not_login"){qing.event.stop(u);qui.showLogin();return false}else{if(qVisitorInfo.loginStatus!="activated"){qing.event.stop(u);qui.showActive();return false}}return true};var d=function(w){var v=qext.fn.getAncestorByClass(this,"mod-repost-content");var u=qing.dom.query(".q-reasonitem",v);qing.array.each(u,function(x){qing.dom.removeClass(x,"hide")});qing.dom.removeClass(this,"a-expand-reason");qing.dom.addClass(this,"a-collapse-reason");this.innerHTML="收起";qing.event.stop(w)};var c=function(w){var v=qext.fn.getAncestorByClass(this,"mod-repost-content");var u=qing.dom.query(".q-reasonitem",v);qing.array.each(u,function(y,x){if(x===0){return}qing.dom.addClass(y,"hide")});qing.dom.removeClass(this,"a-collapse-reason");qing.dom.addClass(this,"a-expand-reason");this.innerHTML="查看更多转载理由";qing.event.stop(w)};var b=function(u){var v=this;qui.showTip({width:140,height:20,msg:"确定要删除这篇博客吗？",target:v,anchor:"top",buttons:[{text:"确定",handler:function(x,w){qing.ajax.post("/pub/submit/deleteblog",{qbid:detailPage.threadId,bdstoken:qBdsToken},function(y){qui.showSuccess("删除成功");x.close();setTimeout(function(){var z=qPageInfo.referUrl;if(!z||!/^http/.test(z)){z=qDomain.qing+"/new"+qUserInfo.qingUrl+"/blog"}location.href=z},600)},function(y){qui.showError("删除失败");x.close()})}},{text:"取消",type:"silver",handler:function(x,w){x.close()}}]});qing.event.stop(u)};var q=function(w){if(!n(w)){return false}var x=this;var y={};y.name=detailPage.originAuthorName;y.portrait=detailPage.originPortrait;var A=qing.dom.query("#shareBnt .share-nub")[0];var z=qing.dom.query("#commentBnt .comment-nub")[0];var u=function(F,C,D){if(C.toReplyeeId){if(D.indexOf("回")==0){D=D.replace("回复 "+C.toReplyeeName+"：","")}else{C.toReplyeeId=""}}var H="";if(C.toReplyeeId){H=qing.string.format(qcmt.tpl.cmtReplyDetailTpl,{userUrl:qDomain.qing+"/go/check?portrait="+C.userInfo.portrait,userName:C.userInfo.userName,replyeeUrl:C.toUrl,replyeeName:C.toReplyeeName,summary:qing.string.filterFormat.escapeString(D),isWiseIcoShowClass:"hide",imgUrl:C.userInfo.avatar||"",userId:C.userInfo.portrait||""})}else{H=qing.string.format(qcmt.tpl.cmtDetailTpl,{userUrl:qDomain.qing+"/go/check?portrait="+C.userInfo.portrait,userName:C.userInfo.userName,summary:qing.string.filterFormat.escapeString(D),isWiseIcoShowClass:"hide",imgUrl:C.userInfo.avatar||"",userId:C.userInfo.portrait||""})}var E="";if(F&&F[0]&&F[0].replyIdEnc){E=F[0].replyIdEnc}else{return}var G=qing.string.format(qcmt.tpl.cmtItem,{userUrl:qDomain.qing+"/go/check?portrait="+C.userInfo.portrait,userId:C.userInfo.portrait,userName:C.userInfo.userName,imgUrl:C.userInfo.avatar,cmtDetailTpl:H,cmtId:E,cmtPubTime:qing.date.format(new Date(F[0].cdatetime*1000),"yyyy-MM-dd HH:mm"),isHoverShowClass:"delete-hover-show",isReplyHideClass:"hide"});var B=qing.dom.query(".cmt-list")[0];qing.dom.insertHTML(B,"afterBegin",G)};qext.fn.scrollFix(x);var v=qing.g("shareDetail");qdetail.repostBuilder=qcmt.build(v,{type:"repost",target:x,numElem:A,extraNumElem:z,id:detailPage.threadId,actorPortrait:qUserInfo.portrait,actorName:qUserInfo.userName,actorQingUrl:qUserInfo.qingUrl,contentType:detailPage.contentType,originAuthor:y,originThreadId:detailPage.originThreadId,repostSuccess:u,count:20,max:100000000})};var k=function(u){if(!n(u)){return false}qing.dom.query("#commentDetail .qcmt-textarea-box")[0].focus();qdetail.repostBuilder&&qdetail.repostBuilder.destroy()};var i=function(u){if(qVisitorInfo.loginStatus=="not_login"){qing.event.stop(u);qui.showLogin();return false}else{if(qVisitorInfo.loginStatus!="activated"){qing.event.stop(u);qui.showActive();return false}else{return true}}};var j=function(u){if(!i(u)){return false}var v=this;qing.ajax.post(qDomain.qing+qUserInfo.qingUrl+"/qfriend/submit/addcare",{uname:qUserInfo.userName,bdstoken:qBdsToken},function(x){qui.showSuccess("关注成功");qing.dom.addClass(v,"a-btn-followed");qing.dom.removeClass(v,"a-btn-follow");var y=qing.dom.query(".mod-userinfo .q-fans span")[0];var w=parseInt(y.innerHTML,10)||0;y.innerHTML=w+1});qing.event.stop(u)};var g=function(u){if(!i(u)){return false}var v=this;qing.ajax.post(qDomain.qing+qUserInfo.qingUrl+"/qfriend/submit/addcare",{uname:qUserInfo.userName,bdstoken:qBdsToken},function(y){window.qIsNotice=true;qui.showSuccess("关注成功");qing.dom.addClass(v,"a-btn-followed");qing.dom.addClass(v,"a-btn-followed");qing.dom.hide(v);qing.dom.removeClass(v,"a-btn-follow");qdetail.followPopUp&&qdetail.followPopUp.close();var x=qing.dom.query(".mod-userinfo .q-fans span");if(x&&x.length!=0){var z=x[0];var w=parseInt(z.innerHTML,10)||0;z.innerHTML=w+1}});qing.event.stop(u)};var h=function(u){if(!i(u)){return false}var v=this;qing.ajax.post(qDomain.qing+qUserInfo.qingUrl+"/qfriend/submit/deletecare",{uname:qUserInfo.userName,bdstoken:qBdsToken},function(x){qui.showSuccess("取消关注成功");qing.dom.addClass(v,"a-btn-follow");qing.dom.removeClass(v,"a-btn-followed");var y=qing.dom.query(".mod-userinfo .q-fans span")[0];var w=parseInt(y.innerHTML,10)||1;y.innerHTML=w-1});qing.event.stop(u)};var e=function(u){if(!qVisitorInfo.isHost){return}qing.dom.addClass(this,"mouseover")};var m=function(u){if(!qVisitorInfo.isHost){return}qing.dom.removeClass(this,"mouseover")};var s=function(){qing.q("report-btn")&&qing.q("report-btn")[0]&&qing.dom.hasClass(qing.q("report-btn")[0],"hide")&&qing.removeClass(qing.q("report-btn")[0],"hide")};var f=function(){qing.q("report-btn")&&qing.q("report-btn")[0]&&(!qing.dom.hasClass(qing.q("report-btn")[0],"hide"))&&qing.addClass(qing.q("report-btn")[0],"hide")};var l=function(w){w.close();var v;var u=['<div class="mod-report-confirm">',"<p>您的举报已受理，感谢您对百度空间的支持！</p>","<p>我们的员工会尽快处理您的举报</p>"].join("");var x={title:"举报违规行为",opacity:0.2,width:410,height:90,content:u,buttons:[{text:"确定",type:"green",handler:function(){v.close()}}]};v=new qui.dialog.Dialog(x);v.show({isAutoHide:false})};var o=function(w,u){var v=qDomain.qing+"/anti/submit/report";qing.ajax.request(v,{method:"POST",data:{reporter_id:u.erId||"",reportee_id:u.eeId||"",type:u.type||"1",reason:u.reason||"1",item_id:u.itemId||"",blog_id:u.blogId||"",content:u.content||"",url:u.url||qUserInfo.qingUrl},onsuccess:w||function(){}})};var a=function(){var v;var u=['<div class="mod-report-article">',"<p>亲爱的用户：欢迎使用百度空间举报系统，","您的举报信息我们将在取证后处理，","感谢您的支持，请不要恶意举报哦！</p>",'<div class="report-highlight">你要举报的是：</div>','<div class="report-capture clearfix">','<div class="left avatar"><img src="'+qUserAvatar.size40+'"></div>','<div class="left">','<div class="uname">'+qUserInfo.userName+"</div>",'<div class="content" >文章标题：'+detailPage.blogTitle+"</div>","</div>","</div>",'<p class="report-highlight">举报类型：</p>','<form id="reportTypeForm">','<ul class="clearfix">',"<li>",'<input type="radio" name="report_type" id="report_type1" value="1" />&nbsp;','<label for="report_type1">垃圾广告</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type2" value="2" />&nbsp;','<label for="report_type2">淫秽色情</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type3" value="3" />&nbsp;','<label for="report_type3">敏感信息</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type4" value="4" />&nbsp;','<label for="report_type4">人身攻击</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type5" value="5" />&nbsp;','<label for="report_type5">骚扰他人</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type6" value="6" />&nbsp;','<label for="report_type6">其他</label>',"</li>","</ul>","</form>",'<p class="red-tip hide">请选择举报类型~</p>',"</div>"].join("");var w={title:"举报违规行为",opacity:0.2,width:410,height:230,content:u,buttons:[{text:"确定",type:"green",handler:function(){var y=qing.dom.query("#reportTypeForm input:checked")[0];reportReason=y?y.value:"0";var x="1";switch(detailPage.contentType){case"text":x="1";break;case"picture":x="2";break;case"video":x="3";break;case"music":x="4";break;case"repost":x="5";break}if(reportReason!=0){o(function(){l(v)},{erId:qVisitorInfo.portrait,eeId:qUserInfo.portrait,type:x,reason:reportReason,itemId:detailPage.threadId,url:qUserInfo.qingUrl,content:detailPage.blogTitle});v.close()}if(reportReason==0){var z=qing.dom.query(".mod-report-article .red-tip")[0];qing.removeClass(z,"hide");setTimeout(function(){qing.addClass(z,"hide")},5000)}}},{text:"取消",handler:function(){v.close()}}]};v=new qui.dialog.Dialog(w);v.show({isAutoHide:false})};var r={click:{"a-sendmsg":i,"a-btn-follow":j,"a-btn-followed":h,"share-bnt":q,"comment-bnt":k,"a-expand-reason":d,"a-collapse-reason":c,"delete-bnt":b,"report-btn":a},mouseover:{"wraper-avatar":e,"mod-post-content":s},mouseout:{"wraper-avatar":m,"mod-post-content":f}};var t={click:{"a-btn-follow":g}};var p=function(){qext.fn.addEventMap(qing.dom.q("mod-page-main")[0],["click","mouseover","mouseout"],r);qext.fn.addEventMap(qing.dom.q("mod-topbar")[0],["click"],t)};return{run:p}})();qing.registNS("qdetail");qdetail.main=(function(){var j=function(n,l,o){var m=new Image();m.onload=function(){var r=m.width,p=m.height;if(r&&p){var q=r/p;if(r>l){n.width=l;n.height=l/q}}if(o){o()}};m.src=n.src};var e=function(){if(!qing.browser.ie&&qing.browser.ie>6){return}var l=qing.dom.query(".text-content img");qing.array.each(l,function(o,n){var m=qing.dom.getAncestorByClass(o,"content").clientWidth;j(o,m)})};var c=function(){var l=function(s){var p=new Date(qServerInfo.timeStamp*1000);var q=new Date(s*1000);var o=Math.round(p.getTime()/1000-s);var n="";var r=new Date(q.getYear(),q.getMonth()+1,0).getDate();if(o<60){n=o+"秒前"}else{if(o<3600){n=Math.round(o/60)+"分钟前"}else{if(o<3600*24&&p.getDate()==q.getDate()){n=qing.date.format(q,"HH:mm")}else{if(o<3600*24*2&&(p.getDate()-q.getDate()==1||p.getDate()-q.getDate()+r==1)){n=qing.date.format(q,"昨天HH:mm")}else{if(o<3600*24*3&&(p.getDate()-q.getDate()==2||p.getDate()-q.getDate()+r==2)){n=qing.date.format(q,"前天HH:mm")}else{n=q.getMonth()+1+"月"+q.getDate()+"日"}}}}}return n};var m=qing.dom.query(".mod-recent-readers .visit-time");qing.array.each(m,function(p,o){var n=qing.dom.getAttr(p,"data-visit-time");p.innerHTML=l(n)})};var b=function(){var m=qing.dom.g("commentDetail");if(!m){return}var l=qing.dom.query("#commentDetail .comment-content")[0],o=qing.g("commentBnt"),n=qing.dom.query("#commentBnt .comment-nub")[0];if(!l){return}var p=function(){var x=qing.dom.query("#commentDetail .qcmt-textarea-box")[0];var u=location.hash.replace(/^#/,"");var w=40;var v=qing.browser.isWebkit?document.body:document.documentElement;var t=v.scrollTop;if(u=="reply"){x.focus();qext.fn.scrollFix(x);var r=qing.dom.getPosition(x).top-w;var q=r<0?0:r;v.scrollTop=q}else{var s=qing.g(u);if(s){var r=qing.dom.getPosition(s).top-w;var q=r<0?0:r;v.scrollTop=q}}};qdetail.cmtBuilder=qcmt.build(l,{type:"comment",target:o,numElem:n,focus:false,callback:p,bindTargetEvent:false,id:detailPage.threadId,actorPortrait:qUserInfo.portrait,actorQingUrl:qUserInfo.qingUrl,count:20,max:10000000000})};var h=function(){var n=qing.g("content"),m=qing.dom.query(".mod-post-content .description")[0],l=[];if(m){qing.dom.query("ul",m,l);qing.dom.query("ol",m,l)}if(n){qing.dom.query("ul",n,l);qing.dom.query("ol",n,l)}qing.array.each(l,function(p,o){if(p.style.listStyleType&&p.style.listStyleType!="none"){p.style.marginLeft="35px"}})};var d=function(){var l=baidu.dom.query(".op-box")[0],m=baidu.dom.query(".tag-box")[0];if(m&&l){var n=l.offsetHeight;if(n>20){baidu.dom.setStyles(m,{"float":"none",display:"block"})}}};var f=function(){if(qVisitorInfo.isHost){return}if(location.hash=="#repost"){var l=qing.dom.q("share-bnt")[0];if(l){qing.event.fire(l,"click")}}};var k=function(){qext.back2top.init()};var i=function(){if(!window.cmsBlogs||cmsBlogs.switchOn===false){return}var l=qUserInfo.portrait;if(cmsBlogs.recommends[l]){a(cmsBlogs.recommends[l],"recommends")}else{if(cmsBlogs.relates[l]){a(cmsBlogs.relates[l],"relates")}}};var a=function(p,t){var n=qing.dom.g("relateBlog");var r=qing.dom.g("relateBlogList");var m=[];qing.dom.removeClass(n,"hide");var s=p.length;if(s<=7){m=p}else{for(var q=0;q<7;q++){var l=Math.floor(Math.random()*s);var o=qing.array.removeAt(p,l);m.push(o);s--}}qing.array.each(m,function(w,v){var w=w||{};var u=document.createElement("li");if(v==0){qing.dom.addClass(u,"first")}u.innerHTML=['<a target="_blank" href="'+w.url+'" class="qing-stat-nsclick" data-nsclick="m_20121105_detail_'+t+'_img">','<img src="'+w.img+'" class="relate-img" alt="'+w.txt+'" title="'+w.txt+'" /></a>','<a class="relate-txt qing-stat-nsclick" data-nsclick="m_20121105_detail_'+t+'_txt" href="'+w.url+'">'+w.txt+"</a>"].join("");r.appendChild(u)})};var g=function(){qext.lazy.ImageLoad.init();e();qdetail.ListenerMgr.run();f();c();b();h();d();k();i()};return{init:g}})();qing.dom.ready(function(){qdetail.main.init()});